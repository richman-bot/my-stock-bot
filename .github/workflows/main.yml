name: Run Stock Bot Daily

on:
  schedule:
    # 1. 每天晚上 22:00 通知 (台灣 22:00 = UTC 14:00)
    # 設定週日到週四執行，預報週一到週五的盤勢
    - cron: '0 14 * * 0-4'

    # 2. 每天早上 07:45 通知 (台灣 07:45 = UTC 23:45)
    # 設定 UTC 週日至週四，對應台灣週一至週五早上，避開尖峰避免延遲
    - cron: '45 23 * * 0-4'

  workflow_dispatch: # 保留手動執行按鈕

jobs:
  run_bot:
    runs-on: ubuntu-latest
    steps:
      - name: 複製程式碼
        uses: actions/checkout@v3
        
      - name: 安裝 Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'
          
      - name: 安裝必要套件
        run: pip install yfinance pandas requests pytz
        
      - name: 執行股票掃描
        env:
          TG_TOKEN: ${{ secrets.TG_TOKEN }}
          TG_CHAT_ID: ${{ secrets.TG_CHAT_ID }}
        run: python stock_bot.py
